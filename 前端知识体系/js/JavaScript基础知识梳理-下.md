---
title: "JavaScriptåŸºç¡€çŸ¥è¯†æ¢³ç†(ä¸‹)"
date: "2019-03-27"
permalink: "2019-03-27-javascript-second"
---

ğŸ‘‡ å†…å®¹é€Ÿè§ˆ ğŸ‘‡

- å®ç° ES5 ç»§æ‰¿çš„ 4 ç§æ–¹æ³•
- åŸå‹å’ŒåŸå‹é“¾
- ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾
- Event Loop
- æ‰§è¡Œä¸Šä¸‹æ–‡
- é—­åŒ…çš„ç†è§£å’Œåˆ†æ

### ES5 ç»§æ‰¿

> é¢˜ç›®ï¼šES5 ä¸­å¸¸ç”¨ç»§æ‰¿æ–¹æ³•ã€‚

**æ–¹æ³•ä¸€ï¼šç»‘å®šæ„é€ å‡½æ•°**

ç¼ºç‚¹ï¼šä¸èƒ½ç»§æ‰¿çˆ¶ç±»åŸå‹æ–¹æ³•/å±æ€§

```javascript
function Animal() {
  this.species = "åŠ¨ç‰©";
}

function Cat() {
  // æ‰§è¡Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•, ä¸Šä¸‹æ–‡ä¸ºå®ä¾‹å¯¹è±¡
  Animal.apply(this, arguments);
}

/**
 * æµ‹è¯•ä»£ç 
 */
var cat = new Cat();
console.log(cat.species); // output: åŠ¨ç‰©
```

**æ–¹æ³•äºŒï¼šåŸå‹é“¾ç»§æ‰¿**

ç¼ºç‚¹ï¼šæ— æ³•å‘çˆ¶ç±»æ„é€ å‡½æ•°ä¸­ä¼ é€’å‚æ•°ï¼›å­ç±»åŸå‹é“¾ä¸Šå®šä¹‰çš„æ–¹æ³•æœ‰å…ˆåé¡ºåºé—®é¢˜ã€‚

**æ³¨æ„**ï¼šjs ä¸­äº¤æ¢åŸå‹é“¾ï¼Œå‡éœ€è¦ä¿®å¤`prototype.constructor`æŒ‡å‘é—®é¢˜ã€‚

```javascript
function Animal(species) {
  this.species = species;
}
Animal.prototype.func = function() {
  console.log("Animal");
};

function Cat() {}
/**
 * funcæ–¹æ³•æ˜¯æ— æ•ˆçš„, å› ä¸ºåé¢åŸå‹é“¾è¢«é‡æ–°æŒ‡å‘äº†Animalå®ä¾‹
 */
Cat.prototype.func = function() {
  console.log("Cat");
};

Cat.prototype = new Animal();
Cat.prototype.constructor = Cat; // ä¿®å¤: å°†Cat.prototype.constructoré‡æ–°æŒ‡å‘æœ¬èº«

/**
 * æµ‹è¯•ä»£ç 
 */
var cat = new Cat();
cat.func(); // output: Animal
console.log(cat.species); // undefined
```

**æ–¹æ³• 3:ç»„åˆç»§æ‰¿**

ç»“åˆç»‘å®šæ„é€ å‡½æ•°å’ŒåŸå‹é“¾ç»§æ‰¿ 2 ç§æ–¹å¼ï¼Œç¼ºç‚¹æ˜¯ï¼šè°ƒç”¨äº† 2 æ¬¡çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚

```javascript
function Animal(species) {
  this.species = species;
}
Animal.prototype.func = function() {
  console.log("Animal");
};

function Cat() {
  Animal.apply(this, arguments);
}

Cat.prototype = new Animal();
Cat.prototype.constructor = Cat;

/**
 * æµ‹è¯•ä»£ç 
 */
var cat = new Cat("cat");
cat.func(); // output: Animal
console.log(cat.species); // output: cat
```

**æ–¹æ³• 4:å¯„ç”Ÿç»„åˆç»§æ‰¿**

æ”¹è¿›äº†ç»„åˆç»§æ‰¿çš„ç¼ºç‚¹ï¼Œåªéœ€è¦è°ƒç”¨ 1 æ¬¡çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚**å®ƒæ˜¯å¼•ç”¨ç±»å‹æœ€ç†æƒ³çš„ç»§æ‰¿èŒƒå¼**ã€‚ï¼ˆå¼•è‡ªï¼šã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ã€‹ï¼‰

```javascript
/**
 * å¯„ç”Ÿç»„åˆç»§æ‰¿çš„æ ¸å¿ƒä»£ç 
 * @param {Function} sub å­ç±»
 * @param {Function} parent çˆ¶ç±»
 */
function inheritPrototype(sub, parent) {
  // æ‹¿åˆ°çˆ¶ç±»çš„åŸå‹
  var prototype = Object.create(parent.prototype);
  // æ”¹å˜constructoræŒ‡å‘
  prototype.constructor = sub;
  // çˆ¶ç±»åŸå‹èµ‹ç»™å­ç±»
  sub.prototype = prototype;
}

function Animal(species) {
  this.species = species;
}
Animal.prototype.func = function() {
  console.log("Animal");
};

function Cat() {
  Animal.apply(this, arguments); // åªè°ƒç”¨äº†1æ¬¡æ„é€ å‡½æ•°
}

inheritPrototype(Cat, Animal);

/**
 * æµ‹è¯•ä»£ç 
 */

var cat = new Cat("cat");
cat.func(); // output: Animal
console.log(cat.species); // output: cat
```

### åŸå‹å’ŒåŸå‹é“¾

- æ‰€æœ‰çš„å¼•ç”¨ç±»å‹ï¼ˆæ•°ç»„ã€å¯¹è±¡ã€å‡½æ•°ï¼‰ï¼Œéƒ½æœ‰ä¸€ä¸ª`__proto__`å±æ€§ï¼Œ~~å±æ€§å€¼æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡~~
- æ‰€æœ‰çš„å‡½æ•°ï¼Œéƒ½æœ‰ä¸€ä¸ª prototype å±æ€§ï¼Œå±æ€§å€¼ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡
- æ‰€æœ‰çš„å¼•ç”¨ç±»å‹ï¼ˆæ•°ç»„ã€å¯¹è±¡ã€å‡½æ•°ï¼‰ï¼Œ`__proto__`å±æ€§å€¼æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„ prototype å±æ€§å€¼

**æ³¨**ï¼šES6 çš„ç®­å¤´å‡½æ•°æ²¡æœ‰`prototype`å±æ€§ï¼Œä½†æ˜¯æœ‰`__proto__`å±æ€§ã€‚

```javascript
const obj = {};
// å¼•ç”¨ç±»å‹çš„ __proto__ å±æ€§å€¼æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„ prototype å±æ€§å€¼
console.log(obj.__proto__ === Object.prototype); // output: true
```

#### åŸå‹

> é¢˜ç›®ï¼šå¦‚ä½•ç†è§£ JS ä¸­çš„åŸå‹ï¼Ÿ

```javascript
// æ„é€ å‡½æ•°
function Foo(name, age) {
  this.name = name;
}
Foo.prototype.alertName = function() {
  alert(this.name);
};
// åˆ›å»ºç¤ºä¾‹
var f = new Foo("zhangsan");
f.printName = function() {
  console.log(this.name);
};
// æµ‹è¯•
f.printName();
f.alertName();
```

ä½†æ˜¯æ‰§è¡Œ`alertName`æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¿™é‡Œå†è®°ä½ä¸€ä¸ªé‡ç‚¹ **å½“è¯•å›¾å¾—åˆ°ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§æ—¶ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡æœ¬èº«æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆä¼šå»å®ƒçš„`__proto__`ï¼ˆå³å®ƒçš„æ„é€ å‡½æ•°çš„`prototype`ï¼‰ä¸­å¯»æ‰¾**ï¼Œå› æ­¤`f.alertName`å°±ä¼šæ‰¾åˆ°`Foo.prototype.alertName`ã€‚

#### åŸå‹é“¾

> é¢˜ç›®ï¼šå¦‚ä½• JS ä¸­çš„åŸå‹é“¾ï¼Ÿ

ä»¥ä¸Šä¸€é¢˜ä¸ºåŸºç¡€ï¼Œå¦‚æœè°ƒç”¨`f.toString()`ã€‚

1. `f`è¯•å›¾ä»`__proto__`ä¸­å¯»æ‰¾ï¼ˆå³`Foo.prototype`ï¼‰ï¼Œè¿˜æ˜¯æ²¡æ‰¾åˆ°`toString()`æ–¹æ³•ã€‚
1. ç»§ç»­å‘ä¸Šæ‰¾ï¼Œä»`f.__proto__.__proto__`ä¸­å¯»æ‰¾ï¼ˆå³`Foo.prototype.__proto__`ä¸­ï¼‰ã€‚**å› ä¸º`Foo.prototype`å°±æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œå› æ­¤`Foo.prototype.__proto__ = Object.prototype`**
1. æœ€ç»ˆå¯¹åº”åˆ°äº†`Object.prototype.toString`

è¿™æ˜¯å¯¹æ·±åº¦éå†çš„è¿‡ç¨‹ï¼Œå¯»æ‰¾çš„ä¾æ®å°±æ˜¯ä¸€ä¸ªé“¾å¼ç»“æ„ï¼Œæ‰€ä»¥å«åšâ€œåŸå‹é“¾â€ã€‚

### ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾

> é¢˜ç›®ï¼šå¦‚ä½•ç†è§£ JS çš„ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾ã€‚

**â‘  ä½œç”¨åŸŸ**

ES5 æœ‰â€å…¨å±€ä½œç”¨åŸŸâ€œå’Œâ€å‡½æ•°ä½œç”¨åŸŸâ€œã€‚ES6 çš„`let`å’Œ`const`ä½¿å¾— JS ç”¨äº†â€å—çº§ä½œç”¨åŸŸâ€œã€‚

ä¸ºäº†è§£å†³ ES5 çš„å…¨å±€å†²çªï¼Œä¸€èˆ¬éƒ½æ˜¯é—­åŒ…ç¼–å†™ï¼š`(function(){ ... })()`ã€‚å°†å˜é‡å°è£…åˆ°å‡½æ•°ä½œç”¨åŸŸã€‚

**â‘¡ ä½œç”¨åŸŸé“¾**

å½“å‰ä½œç”¨åŸŸæ²¡æœ‰æ‰¾åˆ°å®šä¹‰ï¼Œç»§ç»­å‘çˆ¶çº§ä½œç”¨åŸŸå¯»æ‰¾ï¼Œç›´è‡³å…¨å±€ä½œç”¨åŸŸã€‚**è¿™ç§å±‚çº§å…³ç³»ï¼Œå°±æ˜¯ä½œç”¨åŸŸé“¾**ã€‚

### Event Loop

#### å•çº¿ç¨‹

> é¢˜ç›®ï¼šè®²è§£ä¸‹é¢ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹å’Œç»“æœã€‚

```javascript
var a = true;
setTimeout(function() {
  a = false;
}, 100);
while (a) {
  console.log("whileæ‰§è¡Œäº†");
}
```

è¿™æ®µä»£ç ä¼šä¸€ç›´æ‰§è¡Œå¹¶ä¸”è¾“å‡º"while..."ã€‚**JS æ˜¯å•çº¿ç¨‹çš„ï¼Œå…ˆè·‘æ‰§è¡Œæ ˆé‡Œçš„åŒæ­¥ä»»åŠ¡ï¼Œç„¶åå†è·‘ä»»åŠ¡é˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡**ã€‚

#### æ‰§è¡Œæ ˆå’Œä»»åŠ¡é˜Ÿåˆ—

> é¢˜ç›®ï¼šè¯´ä¸€ä¸‹ JS çš„ Event Loopã€‚

ç®€å•æ€»ç»“å¦‚ä¸‹ï¼š

1. JS æ˜¯å•çº¿ç¨‹çš„ï¼Œå…¶ä¸Šé¢çš„æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯åœ¨ä¸¤ä¸ªåœ°æ–¹æ‰§è¡Œï¼š**æ‰§è¡Œæ ˆå’Œä»»åŠ¡é˜Ÿåˆ—**ã€‚å‰è€…æ˜¯å­˜æ”¾åŒæ­¥ä»»åŠ¡ï¼›åè€…æ˜¯å¼‚æ­¥ä»»åŠ¡æœ‰ç»“æœåï¼Œå°±åœ¨å…¶ä¸­æ”¾å…¥ä¸€ä¸ªäº‹ä»¶ã€‚
1. å½“æ‰§è¡Œæ ˆçš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº†ï¼ˆæ ˆç©ºï¼‰ï¼Œjs ä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶å°†å¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ä»ä»»åŠ¡é˜Ÿåˆ—ä¸¢åˆ°æ‰§è¡Œæ ˆä¸­æ‰§è¡Œã€‚
1. è¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ªç¯è¿›è¡Œï¼Œæ‰€ä»¥ç§°ä½œ`Loop`ã€‚

### æ‰§è¡Œä¸Šä¸‹æ–‡

> é¢˜ç›®ï¼šè§£é‡Šä¸‹â€œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡â€œå’Œâ€œå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡â€ã€‚

â‘ **å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡**

è§£æ JS æ—¶å€™ï¼Œåˆ›å»ºä¸€ä¸ª **å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡** ç¯å¢ƒã€‚æŠŠä»£ç ä¸­å³å°†æ‰§è¡Œçš„ï¼ˆ**å†…éƒ¨å‡½æ•°çš„ä¸ç®—ï¼Œå› ä¸ºä½ ä¸çŸ¥é“å‡½æ•°ä½•æ—¶æ‰§è¡Œ**ï¼‰å˜é‡ã€å‡½æ•°å£°æ˜éƒ½æ‹¿å‡ºæ¥ã€‚**æœªèµ‹å€¼çš„å˜é‡å°±æ˜¯`undefined`**ã€‚

ä¸‹é¢è¿™æ®µä»£ç è¾“å‡ºï¼š`undefined`ï¼›è€Œä¸æ˜¯æŠ›å‡º`Error`ã€‚å› ä¸ºåœ¨è§£æ JS çš„æ—¶å€™ï¼Œå˜é‡ a å·²ç»å­˜å…¥äº†å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­äº†ã€‚

```javascript
console.log(a);
var a = 1;
```

â‘¡**å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡**

å’Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å·®ä¸å¤šï¼Œä½†æ˜¯å¤šäº†`this`å’Œ`arguments`å’Œå‚æ•°ã€‚

åœ¨ JS ä¸­ï¼Œ`this`æ˜¯å…³é”®å­—ï¼Œå®ƒä½œä¸ºå†…ç½®å˜é‡ï¼Œ**å…¶å€¼æ˜¯åœ¨æ‰§è¡Œçš„æ—¶å€™ç¡®å®šï¼ˆä¸æ˜¯å®šä¹‰çš„æ—¶å€™ç¡®å®šï¼‰**ã€‚

### é—­åŒ…çš„ç†è§£å’Œåˆ†æ

> é¢˜ç›®ï¼šè§£é‡Šä¸‹ js çš„é—­åŒ…

ç›´æ¥ä¸Š[MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures)çš„è§£é‡Šï¼šé—­åŒ…æ˜¯**å‡½æ•°**å’Œ**å£°æ˜è¯¥å‡½æ•°çš„è¯æ³•ç¯å¢ƒ**çš„ç»„åˆã€‚

è€Œåœ¨ JavaScript ä¸­ï¼Œå‡½æ•°æ˜¯è¢«ä½œä¸ºä¸€çº§å¯¹è±¡ä½¿ç”¨çš„ï¼Œå®ƒæ—¢å¯ä»¥æœ¬å½“ä½œå€¼è¿”å›ï¼Œè¿˜å¯ä»¥å½“ä½œå‚æ•°ä¼ é€’ã€‚ç†è§£äº†ï¼šâ€œ**Js ä¸­çš„å‡½æ•°è¿è¡Œåœ¨å®ƒä»¬è¢«å®šä¹‰çš„ä½œç”¨åŸŸï¼Œè€Œä¸æ˜¯å®ƒä»¬è¢«æ‰§è¡Œçš„ä½œç”¨åŸŸ**â€ï¼ˆæ‘˜è‡ªã€ŠJavaScript è¯­è¨€ç²¾ç²¹ã€‹ï¼‰ è¿™å¥è¯å³å¯ã€‚

> é¢˜ç›®ï¼šé—­åŒ…ä¼˜ç¼ºç‚¹

é—­åŒ…å°ä½äº†å˜é‡ä½œç”¨åŸŸï¼Œæœ‰æ•ˆåœ°é˜²æ­¢äº†å…¨å±€æ±¡æŸ“ï¼›ä½†åŒæ—¶ï¼Œå®ƒä¹Ÿå­˜åœ¨**å†…å­˜æ³„æ¼**çš„é£é™©ï¼š

- åœ¨æµè§ˆå™¨ç«¯å¯ä»¥é€šè¿‡å¼ºåˆ¶åˆ·æ–°è§£å†³ï¼Œå¯¹ç”¨æˆ·ä½“éªŒå½±å“ä¸å¤§
- åœ¨æœåŠ¡ç«¯ï¼Œç”±äº node çš„å†…å­˜é™åˆ¶å’Œç´¯ç§¯æ•ˆåº”ï¼Œå¯èƒ½ä¼šé€ æˆè¿›ç¨‹é€€å‡ºç”šè‡³æœåŠ¡å™¨æ²“æœº

è§£å†³æ–¹æ³•æ˜¯æ˜¾å¼å¯¹å¤–æš´éœ²ä¸€ä¸ªæ¥å£ï¼Œä¸“é—¨ç”¨ä»¥æ¸…ç†å˜é‡ï¼š

```javascript
function mockData() {
  const mem = {};

  return {
    clear: () => (mem = null), // æ˜¾å¼æš´éœ²æ¸…ç†æ¥å£

    get: page => {
      if (page in mem) {
        return mem[page];
      }
      mem[page] = Math.random();
    }
  };
}
```
